extends ../manageMain.pug

block styles
  link(rel="stylesheet" href="../../css/manage/voucher/voucher.css")

block content
  h2 Voucher Management
  a(href=`/manage/voucher/new`, class="btn btn-primary") Add New Voucher

  form(method="get" class="form-inline mb-3" id="filterForm")
    div(class="form-group mr-2")
      input(type="text" name="search" class="form-control" placeholder="Search by code" value=searchQuery)

    div(class="form-group mr-2")
      select(name="sort" class="form-control" onchange="document.getElementById('filterForm').submit()")
        option(value="createdAt" selected=(sortField == 'createdAt')) --Sorting--
        option(value="code" selected=(sortField == 'code')) Voucher Code
        option(value="discountPercentage" selected=(sortField == 'discountPercentage')) Discount Percentage
        option(value="startDate" selected=(sortField == 'startDate')) Start Date
        option(value="endDate" selected=(sortField == 'endDate')) End Date
        option(value="remainingQuantity" selected=(sortField == 'remainingQuantity')) Remaining Quantity

    // Sorting Order Buttons
    div(class="form-group mr-2")
      button(type="submit" name="order" value="asc" class="btn btn-secondary #{sortOrder == 'asc' ? 'active' : ''}")
        i(class="fa-solid fa-caret-up")
      button(type="submit" name="order" value="desc" class="btn btn-secondary #{sortOrder == 'desc' ? 'active' : ''}")
        i(class="fa-solid fa-caret-down")

  table(class="table table-striped")
    thead
      tr
        th Voucher Code
        th Discount Percentage
        th Minimum Order Value
        th Start Date
        th End Date
        th Total Quantity
        th Remaining Quantity
        th Actions
    tbody
      each voucher in vouchers
        tr
          td #{voucher.code}
          td #{voucher.discountPercentage}%
          td #{voucher.minOrderValue}
          td #{voucher.startDate.toLocaleDateString()}
          td #{voucher.endDate.toLocaleDateString()}
          td #{voucher.totalQuantity}
          td #{voucher.remainingQuantity}
          td
            a(href=`/manage/voucher/${voucher._id}/update`, class="btn btn-warning") Edit
            form(method="post" action=`/manage/voucher/${voucher._id}/delete` class="d-inline")
              button(type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this voucher?')") Delete
            // New button to display carts using this voucher
            a(href=`/manage/voucher/${voucher._id}/carts`, class="btn btn-info") View

  // Pagination Controls
  if totalPages > 1
    nav(aria-label="Page navigation")
      ul(class="pagination")
        if currentPage > 1
          li(class="page-item")
            a(class="page-link" href=`?search=${searchQuery}&sort=${sortField}&order=${sortOrder}&page=${currentPage - 1}`) Previous
        each page in [...Array(totalPages).keys()]
          li(class=`page-item ${page + 1 === currentPage ? 'active' : ''}`)
            a(class="page-link" href=`?search=${searchQuery}&sort=${sortField}&order=${sortOrder}&page=${page + 1}`) #{page + 1}
        if currentPage < totalPages
          li(class="page-item")
            a(class="page-link" href=`?search=${searchQuery}&sort=${sortField}&order=${sortOrder}&page=${currentPage + 1}`) Next
