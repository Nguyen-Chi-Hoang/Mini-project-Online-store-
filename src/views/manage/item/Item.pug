extends ../manageMain.pug

block styles
  link(rel="stylesheet" href="../../css/manage/item/items.css")

block content
  h2 Product Management
  if(managerId==="66c4455bae36599162049449")
    a(href=`/manage/item/new?directory=item_images`, class="btn btn-primary") Add New Product

  form(method="get" class="form-inline mb-3" id="filterForm")
    div(class="form-group mr-2")
      select(name="category" class="form-control" onchange="document.getElementById('filterForm').submit()")
        option(value="" selected=(selectedCategory == '')) All Categories
        each category in categories
          option(value=category.category_name selected=(selectedCategory == category.category_name)) #{category.category_name}

    div(class="form-group mr-2")
      input(type="text" name="search" class="form-control" placeholder="Search by name" value=searchQuery)

    div(class="form-group mr-2")
      select(name="sort" class="form-control" onchange="document.getElementById('filterForm').submit()")
        option(value="createdAt" selected=(sortField == 'createdAt')) --Sorting--
        option(value="name" selected=(sortField == 'name')) Product name
        option(value="importPrice" selected=(sortField == 'importPrice')) Import price
        option(value="purchasePrice" selected=(sortField == 'purchasePrice')) Purchase price
        option(value="salePrice" selected=(sortField == 'salePrice')) Sale price
        option(value="inventoryQuantity" selected=(sortField == 'inventoryQuantity')) Inventory quantity
        option(value="weight" selected=(sortField == 'weight')) Weight

    // Sorting Order Buttons
    div(class="form-group mr-2")
      button(type="submit" name="order" value="asc" class="btn btn-secondary #{sortOrder == 'asc' ? 'active' : ''}")
        i(class="fa-solid fa-caret-up")
      button(type="submit" name="order" value="desc" class="btn btn-secondary #{sortOrder == 'desc' ? 'active' : ''}")
        i(class="fa-solid fa-caret-down")

  div(class="table-responsive")
    table(class="table table-striped")  
      thead
        tr
          th Product Name
          th Barcode
          th Category Type
          th Import Price
          th Purchase Price
          th Inventory Quantity
          th Weight
          th Image
          th Description
          th Actions
      tbody
        each item in items
          tr
            td #{item.name}
            td 
              img(src=`/${item.barcode}`, alt="Barcode Image", class="item-img")
            td #{item.category_type}
            td #{item.importPrice}
            td #{item.purchasePrice}
            td #{item.inventoryQuantity}
            td #{item.weight}
            td
              if item.image
                img(src=`/${item.image}`, alt="Item Image", class="item-img")
              else
                | No Image
            td #{item.description}
            td.actions
              a(href=`/manage/item/${item._id}/update?directory=item_images`, class="btn btn-warning") Edit
              a(href=`/manage/item/${item._id}/customers`, class="btn btn-info") View
              form(method="post" action=`/manage/item/${item._id}/delete`, class="inline-form")
                button(type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this item?')") Delete


  // Pagination Controls
  if totalPages > 1
    nav(aria-label="Page navigation")
      ul(class="pagination")
        if currentPage > 1
          li(class="page-item")
            a(class="page-link" href=`?category=${selectedCategory}&search=${searchQuery}&sort=${sortField}&order=${sortOrder}&page=${currentPage - 1}`) Previous
        each page in [...Array(totalPages).keys()]
          li(class=`page-item ${page + 1 === currentPage ? 'active' : ''}`)
            a(class="page-link" href=`?category=${selectedCategory}&search=${searchQuery}&sort=${sortField}&order=${sortOrder}&page=${page + 1}`) #{page + 1}
        if currentPage < totalPages
          li(class="page-item")
            a(class="page-link" href=`?category=${selectedCategory}&search=${searchQuery}&sort=${sortField}&order=${sortOrder}&page=${currentPage + 1}`) Next
